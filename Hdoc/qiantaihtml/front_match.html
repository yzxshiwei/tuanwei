<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>参加比赛</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/style-fcl.css">
</head>
<body>
    <!--头部-->
    <div class="newsHeader">
        <div class="headerContent">
            <!--LOGO-->
            <a href="index.html"><img src="img/SCU_logo.png" width="200px" alt=""> <span> · 团委创立方教育平台</span></a>
            <!--注册、登录-->
            <div class="rAndl">
                <a href="front_login.html">登录</a> <span>|</span> <a href="front_personBm.html">注册</a>
            </div>
        </div>
    </div>
    <!--头部导航-->
    <div id="headerNav">
        <div class="navContent">
            
        </div>
    </div>
    <div id="match">
        <!--poster-->
        <img class="poster" src="img/match.png"/>
        <!--报名申请-->
        <div class="bmApply" >
            <div class="center">
                <form action="">
                    <p>选择比赛组别：</p>
                    <select name="class" id="class">
                        
                    </select>
                </form>
            </div>
        </div>
        <!--上传作品-->
        <div class="fileWorks" >
            <div class="center">
                <form action="">
                    <p>报名表上传：</p>
                    <a target="_blank" href="" id="download">比赛相关表格下载</a>
                    <label><input type="file" id="upload_file" name="file" /></label>
                    <input class="subBtn" id="upload_works" type="button" value="上传报名表"/>
                </form>
            </div>
        </div>
        <!--比赛说明-->
        <div class="matchDes">
            <h3 class="race_header"></h3>
            <center><p id="rule"> </p></center>
        </div>
    </div>
    <!--footer-->
    <div id="footer" class="footer footer2" style="margin: 0">
        <div class="footer-bag">
            
        </div>
    </div>
</body>
<script src="js/jquery.js"></script>
<script src="backend/my-js/root_ui/jquery.ajaxupload.js"></script>
    <script src="js/baidu.js"></script>
<script type="text/html" id="header_temp">   
    <ul class="newsnav">
                <% for(x in header_list){%>
                 <li>
                     <a href="<%=header_list[x]['first_list_href']%>"><%=header_list[x]['first_list_name']%></a>
                      <ul class="dropNav">
                     <% for (y in header_list[x]['second']){%>
                         <li><a href="<%=header_list[x]["second"][y]['second_list_href']%>"><%=header_list[x]["second"][y]['second_list_name']%></a></li>
                     <%}%>
                     </ul>
                 </li>
                 <%}%>
             </ul>
</script>
<script id="footer_temp" type="text/html">
    <% for(x in footer_list){%>
                       <div class="footer-menu">
                       <% for (y in footer_list[x]['second']){%>
                <span><a href="<%=footer_list[x]['second'][y]['second_url']%>"><%=footer_list[x]['second'][y]['second_name']%></a></span>
                
                <%}%>

            </div>
                        
                         
    <%}%>                   
                          
</script>
<script src="js/template.js"></script>

<script>
	//获取url中的参数
    function getUrlParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
        var r = window.location.search.substr(1).match(reg);  //匹配目标参数
        if (r != null) return unescape(r[2]); return null; //返回参数值
    }
    var race_id = getUrlParam('race_id');
		if (!race_id) {
			window.location.href = "./front_match_information.html";
		}
    //生成页面

    $(document).ready(function(){
        $.get("backend/my-php/lee/get_race.php?id="+race_id,function(data){
            console.log(data)
            if("err" in data)
            {

                
                alert(data["err"])
                window.location.href = "./front_match_information.html";
            }
            $(".race_header").html(data["name"])
            $("#rule").html(data["info"])
            var class_ = JSON.parse(data["class"])
            for(x in class_["class"])
            {
                $("#class").append('<option value="'+class_["class"][x]+'">'+class_["class"][x]+'</option>')
            }
            $("#download").attr("href",data["chart"])
        },"json")
    })//差劲的写法

    //提交比赛
    $("#upload_works").click(function(){
        $.ajaxFileUpload({
                    url:'backend/my-php/lee/file_upload.php',//处理图片脚本
                    secureuri :false,
                    fileElementId :'upload_file',//file控件id
                    dataType : 'json',
                    success : function (data, status){
                        up = {"project_id":race_id,"class":$("#class").val(),"add":data.add}
                       $.post("backend/my-php/lee/match_enroll.php",up,function(data,success){
                        if(success){
                            alert("报名成功")
                            window.location.href="./front_match_information.html"
                        }


                       })
                    }
                });


    })

        $('.newsnav li').mouseenter(function(){
            $(this).find($('.dropNav')).slideDown(200);
            $(this).find($('.dropNav')).parent().siblings().find($('ul')).slideUp(200);
        });
        $('.dropNav').mouseleave(function(){
            $(this).slideUp(200);
        });
   
</script>
<script src="js/plugin.js"></script>
</html>